<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IO functions for HARP • harpIO</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="IO functions for HARP">
<meta property="og:description" content="Functions for reading and writing data in the harp framework.
    Readable formats include grib, netCDF, FA, vfld, vobs, SQLite FCTABLE files and
    writeable formats are SQLite FCTABLE files.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">harpIO</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9142</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/read_raw_forecast.html">Reading forecast data</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/andrew-MET/harpIO/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="harpio" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#harpio" class="anchor"></a>harpIO</h1></div>
<p>harpIO provides a set of read and write functions for the harp ecosystem.</p>
<p>The package is currently under development, but the aim is to provide functions to read grib1, grib2, FA, NetCDF and vfld files from weather forecast / climate models; station observations from vobs files, radar / satellite observations from HDF5 files and in house databases at selected meteorological institutes. Further functions will interpolate gridded forecast fields to weather station locations which will in turn be written to portable sqlite database files.</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation:</h2>
<div class="sourceCode" id="cb1"><pre class="r"><span class="co">#&gt;install.packages("devtools")</span>
<span class="kw pkg">devtools</span><span class="kw ns">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span>(<span class="st">"andrew-MET/harpIO"</span>)</pre></div>
<p>If you wish to read data from netcdf files and don’t already have the system libraries installed, you will need to install them:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="fu">sudo</span> apt-get install libnetcdf-dev netcdf-bin libudunits2-dev</a></code></pre></div>
<p>Additionally, for reading from grib and FA files, the R packages Rgrib2, Rfa and meteogrid are needed - these are not publically available, but are available on demand. For interpolating data from NetCDF files, the miIO package is needed, which can be obtained from MET Norway.</p>
</div>
<div id="examples" class="section level2">
<h2 class="hasAnchor">
<a href="#examples" class="anchor"></a>Examples</h2>
<p>To run these examples, you should have access to vfld and vobs files - replace all paths with your own paths and <code>start_date</code>, <code>end_date</code> etc. to fit your data. Note also that to read vfld files from multiple forecast models (or experiments), the data are expected to be in their own directory for each forecast model underneath a common directory . i.e <code>/path/to/vfld/data/model1</code>, <code>/path/to/vfld/data/model2/</code> etc.</p>
<p>To start, load the harpIO package and set up the paths and dates etc. Here we assume the forecast models are called model1, model2 and model3. To begin with a test will be done for two forecasts - one for 00 UTC on 30 May 2017, and then for the same time the next day.</p>
<div class="sourceCode" id="cb3"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">harpIO</span>)
<span class="no">vfld_path</span>          <span class="kw">&lt;-</span> <span class="st">"/path/to/vfld/data"</span>
<span class="no">first_forecast</span>     <span class="kw">&lt;-</span> <span class="fl">2017053000</span>
<span class="no">last_forecast</span>      <span class="kw">&lt;-</span> <span class="fl">2017053100</span>
<span class="no">forecast_models</span>    <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"model1"</span>, <span class="st">"model2"</span>, <span class="st">"model3"</span>)
<span class="no">forecast_frequency</span> <span class="kw">&lt;-</span> <span class="st">"1d"</span></pre></div>
<p>In this case, model1 has 5 members (0-4), and model2 and model3 have 8 members (0-7). We will ask for lead times 0 - 36 hours every 3 hours and use <code><a href="reference/read_eps_interpolate.html">read_eps_interpolate()</a></code> to read in the data setting <code>return_data = TRUE</code> so that we can inspect the data. We set <code>parameter = NULL</code> to read all parameters from the vfld files. Note that when more than one <code>eps_model</code> is asked for, the number of members must be specified for each model in a list, even if each model has the same number of members.</p>
<p>To run this example on ecgate you can set <code>vfld_path &lt;- "/scratch/ms/no/fa1m/vfld"</code></p>
<div class="sourceCode" id="cb4"><pre class="r"><span class="no">forecast_members</span>    <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">model1</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0</span>, <span class="fl">4</span>), <span class="kw">model2</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0</span>, <span class="fl">7</span>), <span class="kw">model3</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0</span>, <span class="fl">7</span>))
<span class="no">forecast_lead_times</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0</span>, <span class="fl">36</span>, <span class="fl">3</span>)

<span class="no">forecast_data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/read_eps_interpolate.html">read_eps_interpolate</a></span>(
  <span class="kw">start_date</span>  <span class="kw">=</span> <span class="no">first_forecast</span>,
  <span class="kw">end_date</span>    <span class="kw">=</span> <span class="no">last_forecast</span>,
  <span class="kw">eps_model</span>   <span class="kw">=</span> <span class="no">forecast_models</span>,
  <span class="kw">parameter</span>   <span class="kw">=</span> <span class="kw">NULL</span>,
  <span class="kw">lead_time</span>   <span class="kw">=</span> <span class="no">forecast_lead_times</span>,
  <span class="kw">members_in</span>  <span class="kw">=</span> <span class="no">forecast_members</span>,
  <span class="kw">by</span>          <span class="kw">=</span> <span class="no">forecast_frequency</span>,
  <span class="kw">file_path</span>   <span class="kw">=</span> <span class="no">vfld_path</span>,
  <span class="kw">return_data</span> <span class="kw">=</span> <span class="fl">TRUE</span>
)</pre></div>
<p>The model data are interpolated to station locations that are supplied with harpIO, which can be seen in the variable <code>station_list</code>.</p>
<div class="sourceCode" id="cb5"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">forecast_data</span>, <span class="kw">n</span> <span class="kw">=</span> <span class="fl">10</span>)
<span class="co">#&gt; # A tibble: 10 x 18</span>
<span class="co">#&gt;    eps_model sub_model fcdate lead_time member members_out validdate   SID</span>
<span class="co">#&gt;    &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;           &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 model1    model1    1.50e9         0 mbr000 mbr000         1.50e9  1001</span>
<span class="co">#&gt;  2 model1    model1    1.50e9         0 mbr000 mbr000         1.50e9  1010</span>
<span class="co">#&gt;  3 model1    model1    1.50e9         0 mbr000 mbr000         1.50e9  1014</span>
<span class="co">#&gt;  4 model1    model1    1.50e9         0 mbr000 mbr000         1.50e9  1015</span>
<span class="co">#&gt;  5 model1    model1    1.50e9         0 mbr000 mbr000         1.50e9  1018</span>
<span class="co">#&gt;  6 model1    model1    1.50e9         0 mbr000 mbr000         1.50e9  1023</span>
<span class="co">#&gt;  7 model1    model1    1.50e9         0 mbr000 mbr000         1.50e9  1025</span>
<span class="co">#&gt;  8 model1    model1    1.50e9         0 mbr000 mbr000         1.50e9  1026</span>
<span class="co">#&gt;  9 model1    model1    1.50e9         0 mbr000 mbr000         1.50e9  1027</span>
<span class="co">#&gt; 10 model1    model1    1.50e9         0 mbr000 mbr000         1.50e9  1033</span>
<span class="co">#&gt; # ... with 10 more variables: lat &lt;dbl&gt;, lon &lt;dbl&gt;, model_elevation &lt;dbl&gt;,</span>
<span class="co">#&gt; #   lat.temp &lt;dbl&gt;, lon.temp &lt;dbl&gt;, model_elevation.temp &lt;dbl&gt;,</span>
<span class="co">#&gt; #   elev &lt;dbl&gt;, name &lt;chr&gt;, parameter &lt;chr&gt;, forecast &lt;dbl&gt;</span></pre></div>
<p>To write out the data to sqlite files, set <code>sqlite_path = /path/to/output</code> where /path/to/output is the directory you want to which you want to write the sqlite files. It is also a good idea to set <code>return_data = FALSE</code> when reading a large amount of data, although this is the default behaviour.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="https://github.com/andrew-MET/harpIO/">https://​github.com/​andrew-MET/​harpIO/​</a>
</li>
<li>Report a bug at <br><a href="https://github.com/andrew-MET/harpIO/issues">https://​github.com/​andrew-MET/​harpIO/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Andrew Singleton <br><small class="roles"> Author, maintainer </small>  </li>
<li>Alex Deckmyn <br><small class="roles"> Author </small>  </li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p>Developed by Andrew Singleton, Alex Deckmyn.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
